<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loja Básica — Calçados</title>
  <!-- Tailwind CSS CDN (modo JIT) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand: { DEFAULT: '#111827', soft: '#1f2937' } },
          boxShadow: { soft: '0 10px 25px rgba(0,0,0,0.08)' }
        }
      }
    }
  </script>
</head>
<body class="bg-gray-50 text-gray-800 min-h-screen">
  <!-- Header -->
  <header class="sticky top-0 z-30 bg-white/80 backdrop-blur border-b">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-2xl font-bold">Loja Básica</h1>
      <nav class="flex items-center gap-4">
        <button id="openCart" class="relative px-4 py-2 rounded-xl bg-brand text-white hover:bg-brand/90 transition">Carrinho <span id="cartCount" class="ml-2 bg-white text-brand text-xs px-2 py-0.5 rounded-full">0</span></button>
      </nav>
    </div>
  </header>

  <!-- Grid de Produtos -->
  <main class="max-w-6xl mx-auto px-4 py-8">
    <h2 class="text-xl font-semibold mb-4">Calçados em destaque</h2>

    <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Cards serão injetados via JS abaixo -->
    </div>
  </main>

  <!-- Drawer do Carrinho -->
  <div id="cartDrawer" class="fixed inset-0 z-40 hidden">
    <div class="absolute inset-0 bg-black/40" data-close-cart></div>
    <aside class="absolute right-0 top-0 h-full w-full sm:w-[420px] bg-white shadow-2xl p-4 flex flex-col">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">Seu carrinho</h3>
        <button class="p-2 hover:bg-gray-100 rounded-lg" data-close-cart>&times;</button>
      </div>
      <div id="cartItems" class="flex-1 overflow-y-auto divide-y"></div>
      <div class="mt-4 space-y-2">
        <div class="flex items-center justify-between text-sm">
          <span>Subtotal</span>
          <strong id="subtotal">R$ 0,00</strong>
        </div>
        <button id="btnCheckout" class="w-full py-3 rounded-xl bg-brand text-white hover:bg-brand/90 disabled:opacity-50">Finalizar & confirmar pagamento</button>
      </div>
    </aside>
  </div>

  <!-- Modal: Confirmar Pagamento / Enviar Comprovante -->
  <div id="paymentModal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/40" data-close-modal></div>
    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[95vw] max-w-xl bg-white rounded-2xl shadow-soft p-6">
      <div class="flex items-start justify-between mb-4">
        <h3 class="text-lg font-semibold">Confirmar pagamento</h3>
        <button class="p-2 hover:bg-gray-100 rounded-lg" data-close-modal>&times;</button>
      </div>

      <p class="text-sm text-gray-600 mb-4">Após o pagamento, envie o comprovante. Vamos checar e despachar seu pedido.</p>

      <form id="paymentForm" class="space-y-3">
        <div>
          <label class="block text-sm font-medium">Pedido #</label>
          <input name="orderId" class="mt-1 w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand/40" placeholder="Ex.: 2025-0001" required />
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium">Nome</label>
            <input name="buyerName" class="mt-1 w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand/40" required />
          </div>
          <div>
            <label class="block text-sm font-medium">E-mail</label>
            <input name="buyerEmail" type="email" class="mt-1 w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand/40" required />
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium">Comprovante (imagem ou PDF)</label>
          <input name="receipt" type="file" accept="image/*,application/pdf" class="mt-1 w-full" required />
        </div>
        <div>
          <label class="block text-sm font-medium">Observações (opcional)</label>
          <textarea name="notes" class="mt-1 w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-brand/40" rows="3" placeholder="Ex.: fiz PIX às 14:32"></textarea>
        </div>
        <button class="w-full py-3 rounded-xl bg-brand text-white hover:bg-brand/90" type="submit">Enviar comprovante</button>
        <p id="paymentStatus" class="text-sm text-gray-600"></p>
      </form>
    </div>
  </div>

  <footer class="max-w-6xl mx-auto px-4 pb-10 text-center text-xs text-gray-500">&copy; <span id="year"></span> Loja Básica. Todos os direitos reservados.</footer>

  <script>
    // --- Mock de produtos (você pode integrar com sua API depois)
    const PRODUCTS = [
      { id: 'SNEAK-001', name: 'Tênis Runner Lite', price: 199.9, img: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?q=80&w=1200&auto=format&fit=crop', desc: 'Leve, confortável e resistente ao dia a dia.' },
      { id: 'SNEAK-002', name: 'Tênis Street Pro', price: 259.9, img: 'https://images.unsplash.com/photo-1542291026-1e2236d11020?q=80&w=1200&auto=format&fit=crop', desc: 'Visual urbano com sola aderente.' },
      { id: 'SNEAK-003', name: 'Chinelo SoftCloud', price: 69.9, img: 'https://images.unsplash.com/photo-1600180758890-6b94519a8ba6?q=80&w=1200&auto=format&fit=crop', desc: 'Conforto absoluto para casa e praia.' },
    ];

    const cart = [];

    const productGrid = document.getElementById('productGrid');
    const cartDrawer = document.getElementById('cartDrawer');
    const cartItems = document.getElementById('cartItems');
    const cartCount = document.getElementById('cartCount');
    const subtotalEl = document.getElementById('subtotal');
    const openCartBtn = document.getElementById('openCart');
    const paymentModal = document.getElementById('paymentModal');
    const paymentForm = document.getElementById('paymentForm');
    const paymentStatus = document.getElementById('paymentStatus');

    // Render cards
    function renderProducts() {
      productGrid.innerHTML = PRODUCTS.map(p => `
        <article class="bg-white rounded-2xl shadow-soft overflow-hidden flex flex-col">
          <img src="${p.img}" alt="${p.name}" class="h-52 w-full object-cover" />
          <div class="p-4 flex-1 flex flex-col">
            <h3 class="font-semibold text-lg">${p.name}</h3>
            <p class="text-sm text-gray-600 mt-1 flex-1">${p.desc}</p>
            <div class="mt-3 flex items-center justify-between">
              <span class="font-bold">R$ ${p.price.toFixed(2).replace('.', ',')}</span>
              <button class="px-4 py-2 rounded-xl bg-brand text-white hover:bg-brand/90" data-add="${p.id}">Adicionar</button>
            </div>
          </div>
        </article>`).join('');

      // Bind add-to-cart
      productGrid.querySelectorAll('[data-add]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-add');
          const item = PRODUCTS.find(p => p.id === id);
          const existing = cart.find(c => c.id === id);
          if (existing) existing.qty += 1; else cart.push({ ...item, qty: 1 });
          updateCartUI();
        });
      });
    }

    function currencyBRL(n) {
      return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    function updateCartUI() {
      cartCount.textContent = cart.reduce((s, i) => s + i.qty, 0);
      cartItems.innerHTML = cart.length ? cart.map(i => `
        <div class="flex items-center gap-3 py-3">
          <img src="${i.img}" class="w-16 h-16 object-cover rounded-xl" alt="${i.name}" />
          <div class="flex-1">
            <div class="font-medium">${i.name}</div>
            <div class="text-xs text-gray-500">${currencyBRL(i.price)} × ${i.qty}</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="px-2 py-1 rounded-lg bg-gray-100" data-dec="${i.id}">-</button>
            <button class="px-2 py-1 rounded-lg bg-gray-100" data-inc="${i.id}">+</button>
            <button class="px-2 py-1 rounded-lg bg-red-50 text-red-600" data-rem="${i.id}">Remover</button>
          </div>
        </div>`).join('') : '<p class="text-sm text-gray-500">Seu carrinho está vazio.</p>';

      const subtotal = cart.reduce((s, i) => s + i.price * i.qty, 0);
      subtotalEl.textContent = currencyBRL(subtotal);

      cartItems.querySelectorAll('[data-dec]').forEach(b => b.onclick = () => { const it = cart.find(i => i.id === b.dataset.dec); if (it && it.qty > 1) it.qty--; updateCartUI(); });
      cartItems.querySelectorAll('[data-inc]').forEach(b => b.onclick = () => { const it = cart.find(i => i.id === b.dataset.inc); if (it) it.qty++; updateCartUI(); });
      cartItems.querySelectorAll('[data-rem]').forEach(b => b.onclick = () => { const idx = cart.findIndex(i => i.id === b.dataset.rem); if (idx > -1) cart.splice(idx, 1); updateCartUI(); });

      document.getElementById('btnCheckout').disabled = cart.length === 0;
    }

    // Drawer/cart open/close
    openCartBtn.addEventListener('click', () => cartDrawer.classList.remove('hidden'));
    cartDrawer.addEventListener('click', (e) => { if (e.target.hasAttribute('data-close-cart')) cartDrawer.classList.add('hidden'); });

    // Checkout -> abrir modal de pagamento
    document.getElementById('btnCheckout').addEventListener('click', () => {
      paymentModal.classList.remove('hidden');
    });
    paymentModal.addEventListener('click', (e) => { if (e.target.hasAttribute('data-close-modal')) paymentModal.classList.add('hidden'); });

    // Enviar comprovante para o backend (você criará o endpoint /api/confirm-payment)
    paymentForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      paymentStatus.textContent = 'Enviando comprovante...';

      const formData = new FormData(paymentForm);
      formData.append('cart', JSON.stringify(cart));

      try {
        const res = await fetch('/api/confirm-payment', {
          method: 'POST',
          body: formData
        });
        if (!res.ok) throw new Error('Falha ao enviar');
        const data = await res.json();
        paymentStatus.textContent = 'Comprovante enviado com sucesso! Verificaremos e despacharemos seu pedido.';
        paymentForm.reset();
        cart.length = 0; updateCartUI();
        setTimeout(()=>{ paymentModal.classList.add('hidden'); cartDrawer.classList.add('hidden'); }, 1200);
      } catch (err) {
        console.error(err);
        paymentStatus.textContent = 'Erro ao enviar comprovante. Tente novamente.';
      }
    });

    // Init
    renderProducts();
    updateCartUI();
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>